'use strict';
var DoQmentDB  = require('..');
var CONFIG     = require('../config');
var connection = new (require('documentdb').DocumentClient)(CONFIG.HOST, CONFIG.OPTIONS);

var db = new DoQmentDB(connection, 'test');
var users = db.use('users');

var model = {
  name: {
    type: String,
    default: ''
  }
}

users.schema(model)

users.pre('save', function(next) {
  this.createdAt = new Date().toString()
  next()
})

var errors = 0, successes = 0

function createUser(index) {
  users
    .create({ name: 'agon' })
    .then(function(data) {
      console.log('Created user:', data.id)
      successes += 1
    })
    .catch(function() {
      console.log('Error at i=%d', index)
      errors += 1
    })
}

var createUsers = setInterval(function() {
  for(var i = 0; i < 50; i += 1) {
    createUser(i)
  }
}, 500)

setTimeout(function() {
  clearInterval(createUsers)
  console.log('Success: %d', successes)
  console.log('Errors: %d', errors)
}, 5000)